#!/bin/bash

BASEDIR=`dirname $0`/..
. "$BASEDIR"/bin/mn_includes

# This helper creates a unique machine ID for DBUS.

MID=`/usr/bin/dbus-uuidgen`
# see https://unix.stackexchange.com/questions/191313/why-is-my-systemd-journal-not-persistent-across-reboots
echo -n "Unmounting /etc/machine-id..."
sudo umount /etc/machine-id && success || failure
echo -n "Setting machine ID to new random value \'$MID\'..."
sudo /bin/bash -c 'echo "$MID" > /etc/machine-id' && success || failure
echo -n "Setting read-only..."
sudo chmod 444 /etc/machine-id && success || failure

