#!/bin/bash

BASEDIR=`dirname $0`
. "$BASEDIR"/mn_includes

OLDPWD=`pwd`
TARGET=`realpath "$BASEDIR"/../overlay`
cd "$BASEDIR"/../custom_builds

find "$BASEDIR" -name "mn_compile.*.*" ! -name "*~" | sort | while read line ; do
  line=`realpath "$line"`
  WORKDIR=`echo "$line" | cut -d "." -f 3-`
  cd "$WORKDIR"
  scream "Compiling \"$line\"..."
  . "$line" "$TARGET" && success || bail
  cd ..
done

echo "Compiled programs have been installed to $TARGET. Deploy with 'sudo "$BASEDIR"/mn_deploy_medianet_overlay' to activate them."
