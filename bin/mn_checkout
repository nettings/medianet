#!/bin/bash

BASEDIR=`dirname $0`
. "$BASEDIR"/mn_includes

OLDPWD=`pwd`
if [[ -z "$1" ]] ; then
  TARGET='mn_checkout.*'
else
  TARGET='mn_checkout.'$1
fi


# from_FOO <URL> <dirname>
from_git() {
  if [[ ! -d "$2" ]] ; then
    git clone "$1" "$2"
  else
    cd "$2"
    git pull
  fi
}

from_tar() {
  wget -O - "$1" | tar xvf -
  mv -T "$2"* "$2"
}

scream "Iterating over \"$TARGET\"."

cd "$BASEDIR/../custom_builds"
find "$BASEDIR" -name "$TARGET" ! -name "*~" | while read line ; do
  scream "Running "`basename $line`"..."
  . $line && success || failure
done
