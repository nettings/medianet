#!/bin/bash

BASEDIR=`dirname $0`
. "$BASEDIR"/mn_includes

OLDPWD=`pwd`
if [[ -z "$1" ]] ; then
  TARGET='mn_checkout.*'
else
  TARGET='mn_checkout.'$1
fi


# from_FOO <URL> <dirname>
from_git() {
  if [[ ! -d "$2" ]] ; then
    git clone "$1" "$2"
  else
    cd "$2"
    git pull
  fi
}

from_tar() {
  if [[ ! -d "$2" ]] ; then
    mkdir "$2"
  fi
  cd "$2"
  ALGO=
  case `basename "$1"` in
    *.gz|*.tgz)
      ALGO=z
      ;;
    *.bz2|*.tbz)
      ALGO=j
      ;;
    *.xz)
      ALGO=J
      ;;
  esac
  wget -O - "$1" | tar --strip-components=1 -x -v -$ALGO -f -
}

scream "Iterating over \"$TARGET\"."

cd "$BASEDIR/../custom_builds"
find "$BASEDIR" -name "$TARGET" ! -name "*~" | while read line ; do
  scream "Running "`basename $line`"..."
  . $line && success || failure
done
